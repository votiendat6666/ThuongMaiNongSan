

{% extends 'user/layout.html' %}
{% import 'user/voucher_macro.html' as voucher_macros %}

{% block title %} Voucher {% endblock %}

{% block content_right %}
<div style="background-color:#fff; padding:20px 30px; border-radius: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

  {{ voucher_macros.voucher_modal(voucher,order_total_amount_selected, session_voucher_code) }}
<script>
  // üëâ Bi·∫øn gi·ªØ voucher ƒëang ch·ªçn
  var sessionVoucherCode = "{{ session_voucher_code | default('', true) }}";
  var selectedVoucher = {
    code: sessionVoucherCode || null,
    price: 0,
    minOrder: 0
  };

  document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.copy-button');
    const wrappers = document.querySelectorAll('.voucher-code-wrapper');

    // N·∫øu m·ªü ra c√≥ s·∫µn session voucher ‚Üí g√°n n√∫t 'ƒê√£ ch·ªçn'
    if (sessionVoucherCode) {
      buttons.forEach(b => {
        if (b.dataset.voucherCode === sessionVoucherCode) {
          selectedVoucher.code = sessionVoucherCode;
          updateButtonState(b);
        }
      });
    }

    // Click n√∫t 'Ch·ªçn m√£'
    buttons.forEach(button => {
      button.addEventListener('click', function () {
        handleVoucherClick(this, buttons);
      });
    });

    // Click wrapper ‚Üí c≈©ng ch·ªçn
    wrappers.forEach(wrapper => {
      wrapper.addEventListener('click', function () {
        const button = this.closest('.voucher-card').querySelector('.copy-button');
        handleVoucherClick(button, buttons);
      });
    });

    function handleVoucherClick(button, buttons) {
      const code = button.dataset.voucherCode;

      if (selectedVoucher.code === code) {
        selectedVoucher.code = null;
      } else {
        selectedVoucher.code = code;
      }

      buttons.forEach(b => {
        if (b.dataset.voucherCode === selectedVoucher.code) {
          updateButtonState(b);
        } else {
          b.textContent = 'Ch·ªçn m√£';
          b.classList.remove('copied');
        }
      });
    }

    function updateButtonState(button) {
      button.textContent = 'ƒê√£ ch·ªçn';
      button.classList.add('copied');
    }
  });
</script>
</div>
{% endblock %}
